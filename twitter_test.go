//
// Copyright 2009 Bill Casarin <billcasarin@gmail.com>
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//    http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
package twitter

import "testing"

const kId = 5641609144;


func TestStatusWellFormed(t *testing.T) {
  api := NewApi();
  errors := api.GetErrorChannel();
  status := make([]Status, 2);
  var id int64 = kId;

  statusChan := api.GetStatusAsync(kId);
  status[1] = api.GetStatus(kId);
  status[0] = <-statusChan;

  if !StatusEqual(status[0], status[1]) {
    t.Errorf("GetStatusAsync(%d) != GetStatus(%d), expected ==", id, id);
  }

  s := status[0];

  if IsEmpty(s.AsJsonString()) {
    t.Error("Status.AsJsonString() is empty, expected not empty");
  }

  if s.GetId() <= 0 {
    t.Error("Status.GetId() is <= 0, expected > 0");
  }

  if IsEmpty(s.GetCreatedAt()) {
    t.Error("Status.GetCreatedAt() is empty, expected not empty");
  }

  if IsEmpty(s.GetText()) {
    t.Error("Status.GetText() is empty, expected not empty");
  }

  err, hasErrors := <-errors;
  if hasErrors {
    t.Log("Errors generated by GoTwitter:");
    t.Error(err.String());
  }
}

func IsEmpty(s string) bool {
  return len(s) == 0;
}

func StatusEqual(a, b Status) bool {
  return a.AsJsonString() == b.AsJsonString() &&
         a.GetCreatedAt() == b.GetCreatedAt() &&
         a.GetCreatedAtInSeconds() == b.GetCreatedAtInSeconds() &&
         a.GetFavorited() == b.GetFavorited() &&
         a.GetId() == b.GetId() &&
         a.GetInReplyToScreenName() == b.GetInReplyToScreenName() &&
         a.GetInReplyToStatusId() == b.GetInReplyToStatusId() &&
         a.GetInReplyToUserId() == b.GetInReplyToUserId() &&
         a.GetNow() == b.GetNow();
}
